name: Mango Ultimate Pro Builder
on:
  workflow_dispatch:
    inputs:
      app_name:
        description: 'App Name'
        required: true
      package_name:
        description: 'Package ID'
        required: true
      web_url:
        description: 'Website URL (Optional)'
        required: false
      splash_time:
        description: 'Splash Delay'
        default: '3000'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Android Environment
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Inject Assets & Config
        run: |
          # Create Android folders for Icon and Assets
          mkdir -p app/src/main/assets
          mkdir -p app/src/main/res/drawable
          
          # Handle Web URL vs HTML Code
          if [ "${{ github.event.inputs.web_url }}" != "" ]; then
             echo "window.location.href = '${{ github.event.inputs.web_url }}';" > app/src/main/assets/redirect.js
             echo "<script src='redirect.js'></script>" > app/src/main/assets/index.html
          else
             cp index.html app/src/main/assets/index.html || echo "<h1>Mango Build</h1>" > app/src/main/assets/index.html
          fi

      - name: Setup App Icon & Splash
        run: |
          # Dashboard se upload ki gayi images ko yahan process kiya jayega
          echo "Processing PC uploaded assets..."
          [ -f "icon.png" ] && cp icon.png app/src/main/res/mipmap-hdpi/ic_launcher.png || echo "No custom icon"
          [ -f "splash.png" ] && cp splash.png app/src/main/res/drawable/splash.png || echo "No custom splash"

      - name: Build Professional APK
        run: |
          echo "Compiling ${{ github.event.inputs.app_name }}..."
          # Asli Gradle command yahan aayegi
          mkdir -p release_folder
          echo "Simulated APK Content" > release_folder/app-release.apk

      - name: Upload Finished APK
        uses: actions/upload-artifact@v4
        with:
          name: ${{ github.event.inputs.app_name }}-Package
          path: release_folder/
